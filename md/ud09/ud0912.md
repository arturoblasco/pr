## Patrón DAO (Data Access Object)
El patrón **DAO** es un patrón de diseño que **separa la lógica de acceso a datos de la lógica de negocio**. Proporciona una abstracción de acceso a datos donde cada entidad (como en el *ejercicio 12* de actividades: *Usuario*, *Post*, *Comentario*) tiene su propio DAO que maneja las operaciones **CRUD** (*Create*, *Read*, *Update*, *Delete*) específicas de esa entidad. Esto mejora la modularidad y la reutilización del código, ya que la lógica de acceso a datos está encapsulada en objetos DAO dedicados.

## Implementación paso a paso

Vamos a implementar un ejemplo básico utilizando JDBC para interactuar con una base de datos relacional. Utilizaremos la estructura de base de datos que se proporciona en el *ejercicio 12: paquete `redes`*:

### Paso 0: Definir la clase `DbConnect`

Para simplificar la implementar y conexión a la base de datos podemos crear la clase `DbConnect` (como ya hemos implementado anteriormente en algunos ejercicios):

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DatabaseConnect {
    private static final String JDBC_URL = "jdbc:mysql://localhost:3306/pr_tuNombre";
    private static final String USUARIO = "pr_tuNombre";
    private static final String PASSWORD = "pr_tuContraseña";

    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(JDBC_URL, USUARIO, PASSWORD);
    }
}
```



### Paso 1: Definir las clases de las entidades

Definiremos las clases `Usuario`, `Post`, `Comentario` que representan nuestras entidades:

???+example "Por ejemplo: `Usuario.java`"
	
	```java
	public class Usuario {
		private int id;
		private String nombre;
		private String apellido;
	
		// Constructor, getters y setters y toString
	}
	```

### Paso 2: Definir las interfaces DAO

Luego, definiremos interfaces DAO para cada entidad. Cada interfaz DAO tendrá métodos para realizar operaciones CRUD específicas:

???+example "Por ejemplo: `UsuarioDAO.java`"
	
	```java
	import java.util.List;
	
	public interface UsuarioDAO {
		void crearUsuario(Usuario usuario);      // C: Create
		Usuario obtenerUsuario(int id);          // R: Read
		List<Usuario> obtenerTodosUsuarios();    // R: Read (all)
		void actualizarUsuario(Usuario usuario); // U: Update
		void eliminarUsuario(int id);            // D: Delete
	}
	```

### Paso 3: Implementar las clases DAO

Luego, implementaremos las clases DAO para cada entidad utilizando JDBC para interactuar con la base de datos.

???+example "Por ejemplo: `UsuarioDAOImpl.java`"
	
	```java
	import java.sql.*;
	import java.util.ArrayList;
	import java.util.List;
	
	public class UsuarioDAOImpl implements UsuarioDAO {
	    private static final String INSERT_QUERY = "INSERT INTO users (name, lastName) VALUES (?, ?)";
	    private static final String SELECT_BY_ID_QUERY = "SELECT * FROM users WHERE id = ?";
	    private static final String SELECT_ALL_QUERY = "SELECT * FROM users";
	    private static final String UPDATE_QUERY = "UPDATE users SET name = ?, lastName = ? WHERE id = ?";
	    private static final String DELETE_QUERY = "DELETE FROM users WHERE id = ?";
	
	    @Override
	    public void crearUsuario(Connection con, Usuario usuario) {
	        try (PreparedStatement pst = con.prepareStatement(INSERT_QUERY, Statement.RETURN_GENERATED_KEYS)) {
	
	            pst.setString(1, usuario.getNombre());
	            pst.setString(2, usuario.getApellido());
	
	            int filasInsertadas = st.executeUpdate();
	            if (filasInsertadas > 0) {
	                ResultSet rs = pst.getGeneratedKeys();
	                if (rs.next()) {
	                    int id = rs.getInt(1);
	                    usuario.setId(id);
	                }
	            }
	        } catch (SQLException e) {
	            System.out.println("ERROR: " + e.getMessage());
	        }
	    }
	
	    @Override
	    public Usuario obtenerUsuario(Connection con, int id) {
	        Usuario usuario = null;
	        try (PreparedStatement pst = con.prepareStatement(SELECT_BY_ID_QUERY)) {
	
	            pst.setInt(1, id);
	            ResultSet rs = pst.executeQuery();
	            if (rs.next()) {
	                String nombre = rs.getString("name");
	                String apellido = rs.getString("lastName");
	                usuario = new Usuario(id, nombre, apellido);
	            }
	        } catch (SQLException e) {
	            System.out.println("ERROR: " + e.getMessage());
	        }
	        return usuario;
	    }
	
	    @Override
	    public List<Usuario> obtenerTodosUsuarios(Connection con) {
	        List<Usuario> usuarios = new ArrayList<>();
	        try (Statement pst = con.createStatement();
	             ResultSet rs = pst.executeQuery(SELECT_ALL_QUERY)) {
	
	            while (rs.next()) {
	                int id = rs.getInt("id");
	                String nombre = rs.getString("name");
	                String apellido = rs.getString("lastName");
	                Usuario usuario = new Usuario(id, nombre, apellido);
	                usuarios.add(usuario);
	            }
	        } catch (SQLException e) {
	            System.out.println("ERROR: " + e.getMessage());
	        }
	        return usuarios;
	    }
	
	    @Override
	    public void actualizarUsuario(Connection con, Usuario usuario) {
	        try (PreparedStatement pst = con.prepareStatement(UPDATE_QUERY)) {
	
	            pst.setString(1, usuario.getNombre());
	            pst.setString(2, usuario.getApellido());
	            pst.setInt(3, usuario.getId());
	
	            pst.executeUpdate();
	        } catch (SQLException e) {
	            System.out.println("ERROR: " + e.getMessage());
	        }
	    }
	
	    @Override
	    public void eliminarUsuario(Connection con, int id) {
	        try (PreparedStatement pst = con.prepareStatement(DELETE_QUERY)) {
	
	            pst.setInt(1, id);
	
	            pst.executeUpdate();
	        } catch (SQLException e) {
	            System.out.println("ERROR: " + e.getMessage());
	        }
	    }
	}
	```

### Paso 4: Implementar la lógica de la aplicación

Finalmente, implementaremos la lógica de la aplicación en una clase principal `Main` donde podremos interactuar con los DAOs y la base de datos.

???+example "Por ejemplo: `Main.java`"

    ```java
    import java.util.List;
    import java.util.Scanner;
    
    public class Main {
        public static void main(String[] args) {
            Scanner scanner = new Scanner(System.in);
            
            UsuarioDAO usuarioDAO = new UsuarioDAOImpl();
            PostDAO postDAO = new PostDAOImpl();
            ComentarioDAO comentarioDAO = new ComentarioDAOImpl();
    
    		try (Connection con = DbConnect.getConnection()){
                while (true) {
                    System.out.println("Menú:");
                    System.out.println("1. Gestionar Usuarios");
                    System.out.println("2. Gestionar Posts");
                    System.out.println("3. Gestionar Comentarios");
                    System.out.println("4. Salir");
                    System.out.print("Selecciona una opción: ");
                    int opcion = scanner.nextInt();
                    scanner.nextLine(); // Limpiar el buffer del scanner

                    switch (opcion) {
                        case 1:
                            gestionarUsuarios(con, scanner, usuarioDAO);
                            break;
                        case 2:
                            gestionarPosts(con, scanner, postDAO, usuarioDAO);
                            break;
                        case 3:
                            gestionarComentarios(con, scanner, comentarioDAO, usuarioDAO, postDAO);
                            break;
                        case 4:
                            System.out.println("Saliendo...");
                            scanner.close();
                            System.exit(0);
                        default:
                            System.out.println("Opción inválida. Intenta de nuevo.");
                    }
                }		
    		}
    
        }
    
        private static void gestionarUsuarios(Scanner scanner, UsuarioDAO usuarioDAO) {
            while (true) {
                System.out.println("Menú de Usuarios:");
                System.out.println("1. Crear Usuario");
                System.out.println("2. Ver Usuario por ID");
                System.out.println("3. Ver Todos los Usuarios");
                System.out.println("4. Actualizar Usuario");
                System.out.println("5. Eliminar Usuario");
                System.out.println("6. Volver al Menú Principal");
                System.out.print("Selecciona una opción: ");
                int opcion = scanner.nextInt();
                scanner.nextLine(); // Limpiar el buffer del scanner
    
                switch (opcion) {
                    case 1:
                        System.out.print("Introduce el nombre del usuario: ");
                        String nombre = scanner.nextLine();
                        System.out.print("Introduce el apellido del usuario: ");
                        String apellido = scanner.nextLine();
                        Usuario nuevoUsuario = new Usuario(nombre, apellido);
                        usuarioDAO.crearUsuario(con, nuevoUsuario);
                        System.out.println("Usuario creado con ID: " + nuevoUsuario.getId());
                        break;
                    case 2:
                        System.out.print("Introduce el ID del usuario a consultar: ");
                        int idUsuario = scanner.nextInt();
                        Usuario usuario = usuarioDAO.obtenerUsuario(con, idUsuario);
                        if (usuario != null) {
                            System.out.println("Usuario encontrado:");
                            System.out.println("ID: " + usuario.getId());
                            System.out.println("Nombre: " + usuario.getNombre());
                            System.out.println("Apellido: " + usuario.getApellido());
                        } else {
                            System.out.println("No se encontró ningún usuario con ese ID.");
                        }
                        break;
                    case 3:
                        List<Usuario> usuarios = usuarioDAO.obtenerTodosUsuarios(con);
                        if (!usuarios.isEmpty()) {
                            System.out.println("Listado de Usuarios:");
                            for (Usuario u : usuarios) {
                                System.out.println("ID: " + u.getId() + ", Nombre: " + u.getNombre() + ", Apellido: " + u.getApellido());
                            }
                        } else {
                            System.out.println("No hay usuarios registrados.");
                        }
                        break;
                    case 4:
                        System.out.print("Introduce el ID del usuario a actualizar: ");
                        int idActualizar = scanner.nextInt();
                        scanner.nextLine(); // Limpiar el buffer del scanner
                        Usuario usuarioActualizar = usuarioDAO.obtenerUsuario(con, idActualizar);
                        if (usuarioActualizar != null) {
                            System.out.print("Introduce el nuevo nombre del usuario: ");
                            String nuevoNombre = scanner.nextLine();
                            System.out.print("Introduce el nuevo apellido del usuario: ");
                            String nuevoApellido = scanner.nextLine();
                            usuarioActualizar.setNombre(nuevoNombre);
                            usuarioActualizar.setApellido(nuevoApellido);
                            usuarioDAO.actualizarUsuario(con, usuarioActualizar);
                            System.out.println("Usuario actualizado correctamente.");
                        } else {
                            System.out.println("No se encontró ningún usuario con ese ID.");
                        }
                        break;
                    case 5:
                        System.out.print("Introduce el ID del usuario a eliminar: ");
                        int idEliminar = scanner.nextInt();
                        usuarioDAO.eliminarUsuario(con, idEliminar);
                        System.out.println("Usuario eliminado correctamente.");
                        break;
                    case 6:
                        return;
                    default:
                        System.out.println("Opción inválida. Intenta de nuevo.");
                }
            }
        }
    
        private static void gestionarPosts(Scanner scanner, PostDAO postDAO, UsuarioDAO usuarioDAO) {
            // Implementar lógica similar a gestionarUsuarios para Posts
        }
    
        private static void gestionarComentarios(Scanner scanner, ComentarioDAO comentarioDAO, UsuarioDAO usuarioDAO, PostDAO postDAO) {
            // Implementar lógica similar a gestionarUsuarios para Comentarios
        }
    }
    ```

### Consideraciones

- **JDBC y SQL Queries:** Hemos utilizado JDBC para conectarnos y realizar operaciones en la base de datos. Es importante manejar excepciones y cerrar correctamente las conexiones y recursos.
- **Patrón DAO:** Este patrón nos ayuda a mantener un código organizado y aislado, separando la lógica de acceso a datos de la lógica de negocio.
- **Lógica de la aplicación:** En la clase `Main`, hemos implementado un menú interactivo que permite al usuario gestionar *usuarios*, *posts* y *comentarios* utilizando los métodos proporcionados por los DAOs.
- **Adaptabilidad:** Puedes expandir este ejemplo añadiendo más funcionalidades o haciendo ajustes según los requisitos de tu aplicación.
